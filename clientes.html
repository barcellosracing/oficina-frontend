<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <title>Clientes - Oficina</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <header>
    <h1>Clientes</h1>
    <nav>
      <a href="index.html">Home</a>
      <a href="produtos.html">Produtos</a>
      <a href="motos.html">Motos</a>
      <a href="orcamentos.html">Orçamentos</a>
    </nav>
  </header>

  <main>
    <section>
      <h2>Cadastrar Cliente</h2>
      <form id="form-cliente">
        <input type="text" id="nome" placeholder="Nome" required />
        <input type="text" id="telefone" placeholder="Telefone" />
        <button type="submit">Cadastrar</button>
      </form>

      <h2>Lista de Clientes</h2>
      <table>
        <thead><tr><th>Nome</th><th>Telefone</th><th>Data</th></tr></thead>
        <tbody id="lista-clientes"></tbody>
      </table>
      <p class="footer-note">Atualize a página para recarregar os dados, ou use o botão abaixo.</p>
      <button id="btn-refresh">Atualizar</button>
    </section>
  </main>

<script src="common.js"></script>
<script>
async function fetchClientes() {
  try {
    const res = await fetch(API_BASE + '/api/clientes');
    const data = await handleResponse(res);
    const tbody = document.getElementById('lista-clientes');
    tbody.innerHTML = '';
    data.forEach(c => {
      const tr = document.createElement('tr');
      tr.innerHTML = `<td>${c.nome}</td><td>${c.telefone}</td><td>${new Date(c.created_at).toLocaleString()}</td>`;
      tbody.appendChild(tr);
    });
  } catch (err) {
    alert('Erro ao carregar clientes: ' + err.message);
  }
}

document.getElementById('form-cliente').addEventListener('submit', async (e) => {
  e.preventDefault();
  const nome = document.getElementById('nome').value.trim();
  const telefone = document.getElementById('telefone').value.trim();
  if (!nome) return alert('Nome obrigatório');
  try {
    await handleResponse(await fetch(API_BASE + '/api/clientes', {
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body: JSON.stringify({ nome, telefone })
    }));
    document.getElementById('form-cliente').reset();
    fetchClientes();
  } catch(err) {
    alert('Erro ao criar cliente: ' + err.message);
  }
});

document.getElementById('btn-refresh').addEventListener('click', fetchClientes);

fetchClientes();
</script>
</body>
</html>
